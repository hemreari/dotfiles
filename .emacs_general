;; emacs 26 init file for windowed.
;; Last Edit: 27/07/2020

;; Added by Package.el.  This must come before configurations of
;; installed packages.  Don't delete this line.  If you don't want it,
;; just comment it out by adding a semicolon to the start of the line.
;; You may delete these explanatory comments.

(require 'package)
(add-to-list
 'package-archives
 '("melpa" . "https://melpa.org/packages/") t)
;; Comment/uncomment this line to enable MELPA Stable if desired.  See `package-archive-priorities`
;; and `package-pinned-packages`. Most users will not need or want to do this.
;;(add-to-list 'package-archives '("melpa-stable" . "https://stable.melpa.org/packages/") t)
(package-initialize)

;;(add-to-list 'load-path "C:/Users/hemre/AppData/Roaming/.emacs.d/lisp")


(require 'tramp)
(set-default 'tramp-auto-save-directory "/Users/emreari/.emacs.d/autosave-dir")
(set-default 'tramp-default-method "plink")

;;set default directory
(setq default-directory "~/")

;;general configuration
(setq inhibit-splash-screen t)
(setq backup-directory-alist '(("" . "~/.emacs.d/emacs-backup")))

(display-time-mode 1)
(menu-bar-mode 1)
(tool-bar-mode -1)
(global-linum-mode 1)
(column-number-mode 1)
(show-paren-mode 1)

;flycheck
(require 'flycheck)
  :config
  ;(flycheck-add-mode 'javascript-eslint 'typescript-mode)
  ;(flycheck-add-mode 'javascript-eslint 'javascript-mode)

;;; runs eslint --fix on the current file after save
;;; alpha quality -- use at your own risk

(defun eslint-fix-file ()
  (interactive)
  (message "eslint --fixing the file" (buffer-file-name))
  (shell-command (concat "npx eslint --fix " (buffer-file-name))))

(defun eslint-fix-file-and-revert ()
  (interactive)
  (eslint-fix-file)
  (revert-buffer t t))

;(add-hook 'typescript-mode-hook
;          (lambda ()
;            (add-hook 'after-save-hook #'eslint-fix-file-and-revert)))

;typescript
(defun setup-tide-mode ()
  (interactive)
  (tide-setup)
  (flycheck-mode +1)
  ;(setq flycheck-check-syntax-automatically '(save mode-enabled))
  (eldoc-mode +1)
  (tide-hl-identifier-mode +1)
  (setq-default tab-width 2)
  ;; company is an optional dependency. You have to
  ;; install it separately via package-install
  ;; `M-x package-install [ret] company`
  (company-mode +1))

;; aligns annotation to the right hand side
(setq company-tooltip-align-annotations t)
(eval-after-load 'js-mode
	   '(add-hook 'tide-mode-hook (lambda () (add-hook 'after-save-hook 'eslint-fix nil t))))


;; formats the buffer before saving
;;(add-hook 'before-save-hook 'tide-format-before-save)
(add-hook 'typescript-mode-hook #'setup-tide-mode)

;(require 'company-go)

;(require 'go-autocomplete)
;(require 'auto-complete-config)
;(add-to-list 'ac-dictionary-directories "C:/Users/hemre/AppData/Roaming/.emacs.d/lisp/ac-dict")
;(ac-config-default)
(add-hook 'completion-at-point-functions 'go-complete-at-point)

(put 'upcase-region 'disabled nil)
(put 'downcase-region 'disabled nil)

;;typescript
(defun setup-tide-mode ()
  (interactive)
  (tide-setup)
  (flycheck-mode +1)
  (setq flycheck-check-syntax-automatically '(save mode-enabled))
  (eldoc-mode +1)
  (tide-hl-identifier-mode +1)
  
  ;; company is an optional dependency. You have to
  ;; install it separately via package-install
  ;; `M-x package-install [ret] company`
  (company-mode +1))

;; aligns annotation to the right hand side
(setq company-tooltip-align-annotations t)

;; formats the buffer before saving
;(add-hook 'before-save-hook 'tide-format-before-save)

(add-hook 'typescript-mode-hook #'setup-tide-mode)


;;c-mode
(add-hook 'c-mode-hook
          '(lambda () (c-set-style "java")))

;;go coding
(require 'lsp-mode)
(setq lsp-gopls-codelens nil)
(add-hook 'go-mode-hook #'lsp-deferred)

;; Set up before-save hooks to format buffer and add/delete imports.
;; Make sure you don't have other gofmt/goimports hooks enabled.
(defun lsp-go-install-save-hooks ()
  (add-hook 'before-save-hook #'lsp-format-buffer t t)
  (add-hook 'before-save-hook #'lsp-organize-imports t t))
(add-hook 'go-mode-hook #'lsp-go-install-save-hooks)

;(add-hook 'before-save-hook 'gofmt-before-save)
;(add-hook 'go-mode-hook 'company-mode)
;(add-hook 'go-mode-hook (lambda ()
;  (set (make-local-variable 'company-backends) '(company-go))(company-mode)))

(require 'smartparens-config)

;; global keybindings
;; directory operations
(global-set-key (kbd "C-c C-l") 'list-directory)
(global-set-key (kbd "C-c C-m") 'make-directory)

;; START TABS CONFIG
;; Create a variable for our preferred tab width

(custom-set-variables
 ;; custom-set-variables was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
 '(ansi-color-faces-vector
   [default default default italic underline success warning error])
 '(ansi-color-names-vector
   ["black" "red3" "ForestGreen" "yellow3" "blue" "magenta3" "DeepSkyBlue" "gray50"])
 '(coolumn-number-mode t)
 '(custom-enabled-themes '(misterioso))
 '(display-time-mode t)
 '(package-selected-packages
   '(flycheck-color-mode-line prettier-js gnu-elpa-keyring-update spinner lsp-mode company-php php-mode masm-mode solidity-mode tide typescript-mode magit go-complete company smartparens go-mode))
 '(show-paren-mode t)
 '(smartparens-global-mode t)
 '(tool-bar-mode nil))
(custom-set-faces
 ;; custom-set-faces was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
 )
